<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tic Tac Toe</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; }
    #board { display: grid; grid-template-columns: repeat(3, 100px); gap: 5px; margin: 100px auto; width: max-content; }
    .cell { width: 100px; height: 100px; font-size: 2em; display: flex; align-items: center; justify-content: center; border: 1px solid #333; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Tic Tac Toe</h1>
  <div id="board"></div>
  <p id="status"> Your's turn</p>
  <button onclick="resetGame()">Reset</button>

  <script>
  const boardElement = document.getElementById("board");
  const statusElement = document.getElementById("status");

  function renderBoard(board, currentPlayer, winner) {
    boardElement.innerHTML = "";
    board.forEach((row, i) => {
      row.forEach((cell, j) => {
        const div = document.createElement("div");
        div.className = "cell";
        div.textContent = cell;
        div.onclick = () => makeMove(i, j);
        boardElement.appendChild(div);
      });
    });

    if (winner) {
      statusElement.textContent = `Player ${winner} wins!`;
    } else {
      if (currentPlayer === "X") {
        statusElement.textContent = "Your turn";
       
        
      } else {
        statusElement.textContent = "AI is thinking...";
    
      }
    }
  }

  async function getState() {
    const res = await fetch("/state");
    const data = await res.json();
    renderBoard(data.board, data.current_player, data.winner);
    return data;
  }

  async function makeMove(row, col) {
    // only let user play when it's their turn
    const state = await getState();
    if (state.winner) return;

    await fetch("/move", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ row, col })
    });

    let newState = await getState();

    // trigger AI only if game not over
    if (!newState.winner) {
      await fetch("/ai_move",{ method: "POST" });
      getState();
    }
  }

  async function resetGame() {
    await fetch("/reset", { method: "POST" });
    getState();
  }

  getState();
</script>
</body>
</html>
